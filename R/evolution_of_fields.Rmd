---
title: "Evolution of Fields"
output: pdf_document
date: "2025-09-09"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = F, message = F,
                      fig.width = 10, fig.height = 8, dpi = 300, out.width = "100%")

library(tidyverse)
library(openalexR)
library(tidyverse)
library(here)
library(bibliometrix)
library(bibliometrixData)
library(ggwordcloud)
library(kableExtra)
```


```{r data load and prep, cache=TRUE}

# Folder with the RDS files
rds_folder <- "Evolution Fields/"

# List all RDS files
rds_files <- list.files(rds_folder, pattern = "_metrics\\.RDS$", full.names = TRUE)

# Read and combine
all_metrics <- rds_files %>%
  map_dfr(function(f) {
    df <- readRDS(f)
    
    # Extract window from filename
    # Assumes filenames like "1970-1974_metrics.RDS"
    window <- str_extract(basename(f), "\\d{4}-\\d{4}")
    
    df %>% mutate(window = window)
  }) |> 
  drop_na() |> 
  mutate(window = factor(window, levels = unique(window))) |> 
  group_by(window) |> 
  mutate(totalnumbernodes = sum(numbernodes),
         totalnumberedges = sum(totaledges)) |> 
  ungroup() |> 
  mutate(relative_size_nodes = numbernodes/totalnumbernodes,
         relative_size_edges = totaledges/totalnumberedges,
         relative_size_within_edges = withinedges/totalnumberedges,
         relative_size_between_edges = between_edges/totalnumberedges)



df_long <- all_metrics %>%
  tidyr::pivot_longer(cols = c(internalratio, externalratio,degree,
                               betweeness, closeness, between_edges, withinedges,
                               numbernodes, totaledges, relative_size_nodes,
                               relative_size_edges,relative_size_within_edges,
                               relative_size_between_edges, citations),
                      names_to = "type", values_to = "value")
```

```{r plotting funcs, cache=TRUE}
plot_type <- function(data){
  
  data <- df_long
  
  data_plot <- data |> 
    group_by(window, type) |> 
    summarise(value = mean(value))
  
  ggplot(data_plot, aes(x = window, y = value)) +
    geom_jitter(width = 0.2, height = 0, alpha = 0.7) +
    theme_minimal() +
    facet_wrap(~type, scales="free") +
    theme(axis.text = element_blank()) +
    labs(y = "Metric", x = "Window")
  
  
}


plot_type_field <- function(data,metric){
  
  data_plot <- data |> 
    filter(type %in% metric)
  
  if(length(metric) >= 2){
    
    name <- paste(metric, collapse = "\\/")
    
    ggplot(data_plot, aes(x = window, y = value,color=type)) +
    geom_jitter(width = 0.2, height = 0, alpha = 0.7) +
    theme_minimal() +
    facet_wrap(~stringr::str_wrap(field, width = 30), ncol = 3) +
    theme(strip.text.x = element_text(size = 9, margin = margin(t = 5, b = 5)),
          strip.text.y = element_text(size = 9, margin = margin(l = 5, r = 5)),
          plot.margin = grid::unit(c(1,1,1,1), "cm"),
          axis.text = element_blank(),
          legend.position = "bottom") +
    labs(y = "Metric", x = "Window")

  } else{
    
  ggplot(data_plot, aes(x = window, y = value,color=type)) +
    geom_jitter(width = 0.2, height = 0, alpha = 0.7) +
    theme_minimal() +
    facet_wrap(~stringr::str_wrap(field, width = 30), ncol = 3) +
    theme(strip.text.x = element_text(size = 9, margin = margin(t = 5, b = 5)),
          strip.text.y = element_text(size = 9, margin = margin(l = 5, r = 5)),
          plot.margin = grid::unit(c(1,1,1,1), "cm"),
          axis.text = element_blank(),
          legend.position = "none") +
    labs(y = toupper(metric), x = "Window")

  
  }
}


```


# Aggregate Metrics

```{r metrics_agg, cache=TRUE}
plot_type(df_long)
```

\newpage

# Field-Level Metrics
Field-Level Metrics are derived from networks where articles are nodes and edges are based on the strength of bibliographic coupling between articles. The nodes, edges and their information is then aggregated per discipline, here called field.

## Relative Number of Nodes and Number of Citations

- Relative number of Nodes:
\begin{equation}
RelNodes_{t,f} = \frac{N(V)_{t,f}}{\sum_f^F N(V)_{t,f}} 
\end{equation}
where:
- $RelNodes_{t,f}$ measures the relative number of nodes for field $f$ in time window $t$ across all article nodes
- $N(V)_{t,f}$ measures the total number of nodes for field $f$ in time window $t$ across all article nodes. It is therefore defined as $N(V)_{t,f} = \sum_{v_i} 1_{field(v_i)=f}$, where $1_{field(v_i)=f}$ is an indicator function, taking the value one if article node $v_i$ belongs to field $f$.

- The number of citations per field and time window is measured as the sum of citations across all articles of a field in a give time window, respectively.

```{r nodes_citations}
plot_type_field(df_long, metric = c("relative_size_nodes")) # Nodes(Field)/Nodes(TotalWindow)
plot_type_field(df_long, metric = c("citations"))
```

\newpage

## Relative Number of Edges

- Relative Number of Total Edges:
\begin{equation}
RelEdges_{t,f} = \frac{N(E)_{t,f}}{\sum_f^F N(E)_{t,f}} 
\end{equation}
where:
- $RelEdges_{t,f}$ measures the relative number of edges incident on nodes within field $f$ in time window $t$
- $N(E)_{t,f}$ measures the total number of edges incident on nodes within field $f$ in time window $t$. It is therefore defined as $N(E)_{t,f} = \sum_{e=(v_i,v_j)} 1_{field(v_i)=f \: \vee \: field(v_j) = f}$, where $1_{field(v_k)=f}$ is an indicator function, taking the value one if article node $k$ belongs to field $f$

- Relative Number of Within-Field Edges:
\begin{equation}
RelEdgesWithin_{t,f} = \frac{N(E_{within})_{t,f}}{\sum_f^F N(E)_{t,f}} 
\end{equation}
where:
- $RelEdgesWithin_{t,f}$ measures the relative number of edges between article nodes of the same field for field $f$ in time window $t$
- $N(E_{within})_{t,f}$ measures the total number of edges between article nodes of the same field for field $f$ in time window $t$. It is therefore defined as $N(E_{within})_{t,f} = \sum_{e=(v_i,v_j)} 1_{field\{(v_i)=f\}} 1_{\{field(v_j) = f\}}$, where $1_{field(v_k)=f}$ is an indicator function, taking the value one if article node $k$ belongs to field $f$.

- Relative Number of Between-Field Edges:
\begin{equation}
RelEdgesBetween_{t,f} = \frac{N(E_{Between})_{t,f}}{\sum_f^F N(E)_{t,f}} 
\end{equation}
where:
- $RelEdgesBetween_{t,f}$ measures the relative number of edges between article nodes of different fields for field $f$ in time window $t$
- $N(E_{Between})_{t,f}$ measures the total number of edges between article nodes of different fields for field $f$ in time window $t$. It's defined as $N(E_{Between})_{t,f} = \sum_{e=(v_i,v_j)} \left ( 1_{field\{(v_i=f)\}} 1_{field\{(v_j \neq f)\}} + 1_{field\{(v_i \neq f)\}} 1_{field\{(v_j = f)\}}  \right )$.


```{r edges}
plot_type_field(df_long, metric = c("relative_size_edges")) # Edges(Field)/Edges(TotalWindow)
plot_type_field(df_long, metric = c("relative_size_within_edges", "relative_size_between_edges"))
# Edges(WithinField)/Edges(TotalWindow), Edges(BetweenField)/Edges(TotalWindow)
```

\newpage

## Internal and External Edge Ratio
- Internal Edge Ratio:
\begin{equation}
IR_{t,f} = \frac{N(E_{within})_{t,f}}{N(E)_{t,f}}
\end{equation}
- External Edge Ratio:
\begin{equation}
ER_{t,f} = \frac{N(E_{between})_{t,f}}{N(E)_{t,f}}
\end{equation}

with $N(E_{within})_{t,f}$, $N(E_{between})_{t,f}$ and N(E)_{t,f} defined as before. The internal and external ratios therefore measure the ratio of edges within (between) fields relative to the total number of edges of a field. Edges are derived from article-level nodes.

```{r ratios}
plot_type_field(df_long, metric = c("internalratio", "externalratio"))
# Edges(WithinField)/Edges(WithinField)+Edges(BetweenField), Edges(BetweenField)/Edges(WithinField)+Edges(BetweenField)
```

\newpage

## Network Centrality Metrics (Degree, Closeness and Betweennes)

```{r network_stats}
plot_type_field(df_long, metric = c("degree"))
plot_type_field(df_long, metric = c("closeness"))
plot_type_field(df_long, metric = c("betweeness"))
```

